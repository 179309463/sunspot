<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sunspot::DSL::StandardQuery
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Sunspot.html" title="Sunspot (module)">Sunspot</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../DSL.html" title="Sunspot::DSL (module)">DSL</a></span></span>
     &raquo; 
    <span class="title">StandardQuery</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Sunspot::DSL::StandardQuery
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="FieldQuery.html" title="Sunspot::DSL::FieldQuery (class)">FieldQuery</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></li>
          
            <li class="next"><span class='object_link'><a href="FieldQuery.html" title="Sunspot::DSL::FieldQuery (class)">FieldQuery</a></span></li>
          
            <li class="next">Sunspot::DSL::StandardQuery</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Adjustable.html" title="Sunspot::DSL::Adjustable (module)">Adjustable</a></span>, <span class='object_link'><a href="Paginatable.html" title="Sunspot::DSL::Paginatable (module)">Paginatable</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">sunspot/lib/sunspot/dsl/standard_query.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class presents a DSL for constructing queries using the Sunspot.search
method. Methods of this class are available inside the search block. Much
of the DSL&#8217;s functionality is implemented by this class&#8217;s
superclasses, Sunspot::DSL::FieldQuery and Sunspot::DSL::Scope
</p>
<p>
See Sunspot.search for usage examples
</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="Search.html" title="Sunspot::DSL::Search (class)">Search</a></span></p>
</div>

  <h2>Constant Summary</h2>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Constants inherited from <span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Scope.html#NONE-constant" title="Sunspot::DSL::Scope::NONE (constant)">NONE</a></span></p>



  
  
  
  
  
  
  
  
  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fulltext-instance_method" title="#fulltext (instance method)">- (Object) <strong>fulltext</strong>(keywords, options = {}, &amp;block) </a>
    

    
      (also: #keywords)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Specify a phrase that should be searched as fulltext.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with-instance_method" title="#with (instance method)">- (Object) <strong>with</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Adjustable.html" title="Sunspot::DSL::Adjustable (module)">Adjustable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Adjustable.html#adjust_solr_params-instance_method" title="Sunspot::DSL::Adjustable#adjust_solr_params (method)">#adjust_solr_params</a></span>, <span class='object_link'><a href="Adjustable.html#request_handler-instance_method" title="Sunspot::DSL::Adjustable#request_handler (method)">#request_handler</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Paginatable.html" title="Sunspot::DSL::Paginatable (module)">Paginatable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Paginatable.html#paginate-instance_method" title="Sunspot::DSL::Paginatable#paginate (method)">#paginate</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="FieldQuery.html" title="Sunspot::DSL::FieldQuery (class)">FieldQuery</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="FieldQuery.html#dynamic-instance_method" title="Sunspot::DSL::FieldQuery#dynamic (method)">#dynamic</a></span>, <span class='object_link'><a href="FieldQuery.html#facet-instance_method" title="Sunspot::DSL::FieldQuery#facet (method)">#facet</a></span>, <span class='object_link'><a href="FieldQuery.html#initialize-instance_method" title="Sunspot::DSL::FieldQuery#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="FieldQuery.html#order_by-instance_method" title="Sunspot::DSL::FieldQuery#order_by (method)">#order_by</a></span>, <span class='object_link'><a href="FieldQuery.html#order_by_random-instance_method" title="Sunspot::DSL::FieldQuery#order_by_random (method)">#order_by_random</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Scope.html#all_of-instance_method" title="Sunspot::DSL::Scope#all_of (method)">#all_of</a></span>, <span class='object_link'><a href="Scope.html#any_of-instance_method" title="Sunspot::DSL::Scope#any_of (method)">#any_of</a></span>, <span class='object_link'><a href="Scope.html#dynamic-instance_method" title="Sunspot::DSL::Scope#dynamic (method)">#dynamic</a></span>, <span class='object_link'><a href="Scope.html#initialize-instance_method" title="Sunspot::DSL::Scope#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="Scope.html#text_fields-instance_method" title="Sunspot::DSL::Scope#text_fields (method)">#text_fields</a></span>, <span class='object_link'><a href="Scope.html#without-instance_method" title="Sunspot::DSL::Scope#without (method)">#without</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="FieldQuery.html#initialize-instance_method" title="Sunspot::DSL::FieldQuery#initialize (method)">Sunspot::DSL::FieldQuery</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="fulltext-instance_method">
  
    - (<tt>Object</tt>) <strong>fulltext</strong>(keywords, options = {}, &amp;block) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='keywords-instance_method'>keywords</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Specify a phrase that should be searched as fulltext. Only <tt>text</tt>
fields are searched - see DSL::Fields.text
</p>
<p>
Keyword search is executed using Solr&#8217;s dismax handler, which strikes
a good balance between powerful and foolproof. In particular, well-matched
quotation marks can be used to group phrases, and the + and - modifiers
work as expected. All other special Solr boolean syntax is escaped, and
mismatched quotes are ignored entirely.
</p>
<p>
This method can optionally take a block, which is evaluated by the Fulltext
DSL class, and exposes several powerful dismax features.
</p>
<h4>Parameters</h4>
<table>
<tr><td valign="top">keywords<String></td><td><p>
phrase to perform fulltext search on
</p>
</td></tr>
</table>
<h4>Options</h4>
<table>
<tr><td valign="top">:fields<Array></td><td><p>
List of fields that should be searched for keywords. Defaults to all fields
configured for the types under search.
</p>
</td></tr>
<tr><td valign="top">:highlight<Boolean,Array></td><td><p>
If true, perform keyword highlighting on all searched fields. If an array
of field names, perform highlighting on the specified fields. Note that for
highlighting to work, the desired fields have to be set up with :stored =>
true. This can also be called from within the fulltext block.
</p>
</td></tr>
<tr><td valign="top">:minimum_match<Integer></td><td><p>
The minimum number of search terms that a result must match. By default,
all search terms must match; if the number of search terms is less than
this number, the default behavior applies.
</p>
</td></tr>
<tr><td valign="top">:tie<Float></td><td><p>
A tiebreaker coefficient for scores derived from subqueries that are
lower-scoring than the maximum score subquery. Typically a near-zero value
is useful. See <a
href="http://wiki.apache.org/solr/DisMaxRequestHandler#tie_.28Tie_breaker.29">wiki.apache.org/solr/DisMaxRequestHandler#tie_.28Tie_breaker.29</a>
for more information.
</p>
</td></tr>
<tr><td valign="top">:query_phrase_slop<Integer></td><td><p>
The number of words that can appear between the words in a user-entered
phrase (i.e., keywords in quotes) and still match. For instance, in a
search for &#8220;\&#8220;great pizza\&#8221;&#8220; with a phrase slop of
1, &#8220;great pizza&#8221; and &#8220;great big pizza&#8221; will match,
but &#8220;great monster of a pizza&#8221; will not. Default behavior is a
query phrase slop of zero.
</p>
</td></tr>
</table>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/standard_query.rb', line 58</span>

<span class='kw'>def</span> <span class='id fulltext'>fulltext</span><span class='lparen'>(</span><span class='id keywords'>keywords</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id keywords'>keywords</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id keywords'>keywords</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\s*$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='id fulltext_query'>fulltext_query</span> <span class='op'>=</span> <span class='ivar'>@query</span><span class='period'>.</span><span class='id add_fulltext'>add_fulltext</span><span class='lparen'>(</span><span class='id keywords'>keywords</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id field_names'>field_names</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:fields</span><span class='rparen'>)</span>
      <span class='const'>Util</span><span class='period'>.</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id field_names'>field_names</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id field_name'>field_name</span><span class='op'>|</span>
        <span class='ivar'>@setup</span><span class='period'>.</span><span class='id text_fields'>text_fields</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id field'>field</span><span class='op'>|</span>
          <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id add_fulltext_field'>add_fulltext_field</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id field'>field</span><span class='period'>.</span><span class='id default_boost'>default_boost</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id minimum_match'>minimum_match</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:minimum_match</span><span class='rparen'>)</span>
      <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id minimum_match'>minimum_match</span> <span class='op'>=</span> <span class='id minimum_match'>minimum_match</span><span class='period'>.</span><span class='id to_i'>to_i</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id tie'>tie</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:tie</span><span class='rparen'>)</span>
      <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id tie'>tie</span> <span class='op'>=</span> <span class='id tie'>tie</span><span class='period'>.</span><span class='id to_f'>to_f</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id query_phrase_slop'>query_phrase_slop</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:query_phrase_slop</span><span class='rparen'>)</span>
      <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id query_phrase_slop'>query_phrase_slop</span> <span class='op'>=</span> <span class='id query_phrase_slop'>query_phrase_slop</span><span class='period'>.</span><span class='id to_i'>to_i</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id highlight_field_names'>highlight_field_names</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:highlight</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id highlight_field_names'>highlight_field_names</span> <span class='op'>==</span> <span class='kw'>true</span>
        <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id add_highlight'>add_highlight</span>
      <span class='kw'>else</span>
        <span class='id highlight_fields'>highlight_fields</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
        <span class='const'>Util</span><span class='period'>.</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id highlight_field_names'>highlight_field_names</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id field_name'>field_name</span><span class='op'>|</span>
          <span class='id highlight_fields'>highlight_fields</span><span class='period'>.</span><span class='id concat'>concat</span><span class='lparen'>(</span><span class='ivar'>@setup</span><span class='period'>.</span><span class='id text_fields'>text_fields</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id add_highlight'>add_highlight</span><span class='lparen'>(</span><span class='id highlight_fields'>highlight_fields</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id block'>block</span> <span class='op'>&amp;&amp;</span> <span class='id fulltext_query'>fulltext_query</span>
      <span class='id fulltext_dsl'>fulltext_dsl</span> <span class='op'>=</span> <span class='const'>Fulltext</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id fulltext_query'>fulltext_query</span><span class='comma'>,</span> <span class='ivar'>@setup</span><span class='rparen'>)</span>
      <span class='const'>Util</span><span class='period'>.</span><span class='id instance_eval_or_call'>instance_eval_or_call</span><span class='lparen'>(</span>
        <span class='id fulltext_dsl'>fulltext_dsl</span><span class='comma'>,</span>
        <span class='op'>&amp;</span><span class='id block'>block</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id field_names'>field_names</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id fulltext_dsl'>fulltext_dsl</span> <span class='op'>||</span> <span class='op'>!</span><span class='id fulltext_dsl'>fulltext_dsl</span><span class='period'>.</span><span class='id fields_added?'>fields_added?</span><span class='rparen'>)</span>
      <span class='ivar'>@setup</span><span class='period'>.</span><span class='id all_text_fields'>all_text_fields</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id field'>field</span><span class='op'>|</span>
        <span class='kw'>unless</span> <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id has_fulltext_field?'>has_fulltext_field?</span><span class='lparen'>(</span><span class='id field'>field</span><span class='rparen'>)</span>
          <span class='kw'>unless</span> <span class='id fulltext_dsl'>fulltext_dsl</span> <span class='op'>&amp;&amp;</span> <span class='id fulltext_dsl'>fulltext_dsl</span><span class='period'>.</span><span class='id exclude_fields'>exclude_fields</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='id field'>field</span><span class='period'>.</span><span class='id name'>name</span><span class='rparen'>)</span>
            <span class='id fulltext_query'>fulltext_query</span><span class='period'>.</span><span class='id add_fulltext_field'>add_fulltext_field</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id field'>field</span><span class='period'>.</span><span class='id default_boost'>default_boost</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="with-instance_method">
  
    - (<tt>Object</tt>) <strong>with</strong>(*args) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110
111
112
113
114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/standard_query.rb', line 108</span>

<span class='kw'>def</span> <span class='id with'>with</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span>
  <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Symbol</span>
    <span class='id field_name'>field_name</span> <span class='op'>=</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id value'>value</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>?</span> <span class='id args'>args</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='const'>Scope</span><span class='op'>::</span><span class='const'>NONE</span>
    <span class='kw'>if</span> <span class='id value'>value</span> <span class='op'>==</span> <span class='const'>Scope</span><span class='op'>::</span><span class='const'>NONE</span>
      <span class='kw'>return</span> <span class='const'>DSL</span><span class='op'>::</span><span class='const'>RestrictionWithNear</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='ivar'>@setup</span><span class='period'>.</span><span class='id field'>field</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='period'>.</span><span class='id to_sym'>to_sym</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='ivar'>@scope</span><span class='comma'>,</span> <span class='ivar'>@query</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># else
</span>  <span class='kw'>super</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sat Nov 26 13:47:21 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.9.2).
</div>

  </body>
</html>