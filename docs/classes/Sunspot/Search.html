<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Sunspot::Search [Sunspot - Pure-Ruby Solr Search and Indexing - API Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Sunspot::Search
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../files/lib/sunspot/search_rb.html">lib/sunspot/search.rb</a>
            (<a href="http://github.com/outoftime/sunspot/tree/v0.8.1/lib/sunspot/search.rb">view online</a>)
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            <p>
            This class encapsulates the results of a Solr search. It provides access to
            search results, total result count, facets, and pagination information.
            Instances of <a href="Search.html">Search</a> are returned by the <a
            href="../Sunspot.html#M000006">Sunspot.search</a> method.
            </p>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000032">dynamic_facet</a></li>
              <li><a href="#M000027">execute!</a></li>
              <li><a href="#M000031">facet</a></li>
              <li><a href="#M000029">raw_results</a></li>
              <li><a href="#M000028">results</a></li>
              <li><a href="#M000030">total</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='constants-list'>
              <h2>Constants</h2>
              <div class='name-list'>
                <table summary='Constants'>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>RawResult</td>
                    <td>=</td>
                    <td class='context-item-value'>Struct.new(:class_name, :primary_key)</td>
                    <td>&nbsp;</td>
                    <td class='context-item-desc'>
                      
                      Objects of this class are returned by the <a
                      href="Search.html#M000029">raw_results</a> method.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>query</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'>
                      
                      <a href="Query.html">Query</a> information for this search. If you wish to
                      build the query without using the search DSL, this method allows you to
                      access the query API directly. See <a
                      href="../Sunspot.html#M000005">Sunspot#new_search</a> for how to construct
                      the search object in this case.
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000032'>
                <a name='M000032'>      </a>
                <div class='synopsis'>
                  <span class='name'>dynamic_facet</span>
                  <span class='arguments'>(base_name, dynamic_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Get the facet object for a given dynamic field. This dynamic field will
                  need to have been requested as a field facet inside the search block.
                  </p>
                  <h4>Parameters</h4>
                  <table>
                  <tr><td valign="top">base_name<Symbol>:</td><td>Base name of the dynamic field definiton (as specified in the setup block)
                  
                  </td></tr>
                  <tr><td valign="top">dynamic_name<Symbol>:</td><td>Dynamic field name to facet on
                  
                  </td></tr>
                  </table>
                  <h4>Returns</h4>
                  <table>
                  <tr><td valign="top">Sunspot::Facet:</td><td><a href="Facet.html">Facet</a> object for given dynamic field
                  
                  </td></tr>
                  </table>
                  <h4>Example</h4>
                  <pre>search = Sunspot.search(Post) do&#x000A;  dynamic :custom do&#x000A;    facet :cuisine&#x000A;  end&#x000A;end&#x000A;search.dynamic_facet(:custom, :cuisine)&#x000A;  #=&gt; Facet for the dynamic field :cuisine in the :custom field definition</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000032-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000032-source'><span class="ruby-comment cmt"># File lib/sunspot/search.rb, line 125</span>&#x000A;    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">dynamic_facet</span>(<span class="ruby-identifier">base_name</span>, <span class="ruby-identifier">dynamic_name</span>)&#x000A;      (<span class="ruby-ivar">@dynamic_facets_cache</span> <span class="ruby-operator">||=</span> {})[[<span class="ruby-identifier">base_name</span>.<span class="ruby-identifier">to_sym</span>, <span class="ruby-identifier">dynamic_name</span>.<span class="ruby-identifier">to_sym</span>]] <span class="ruby-operator">||=</span>&#x000A;        <span class="ruby-keyword kw">begin</span>&#x000A;          <span class="ruby-identifier">field</span> = <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">dynamic_field</span>(<span class="ruby-identifier">base_name</span>).<span class="ruby-identifier">build</span>(<span class="ruby-identifier">dynamic_name</span>)&#x000A;          <span class="ruby-constant">Facet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@solr_result</span>.<span class="ruby-identifier">field_facets</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">indexed_name</span>), <span class="ruby-identifier">field</span>)&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000027'>
                <a name='M000027'>      </a>
                <div class='synopsis'>
                  <span class='name'>execute!</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Execute the search on the Solr instance and store the results. If you use
                  <a href="../Sunspot.html#M000006">Sunspot#search()</a> to construct your
                  searches, there is no need to call this method as it has already been
                  called. If you use <a
                  href="../Sunspot.html#M000005">Sunspot#new_search()</a>, you will need to
                  call this method after building the query.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000027-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000027-source'><span class="ruby-comment cmt"># File lib/sunspot/search.rb, line 29</span>&#x000A;    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">execute!</span>&#x000A;      <span class="ruby-identifier">params</span> = <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">to_params</span>&#x000A;      <span class="ruby-ivar">@solr_result</span> = <span class="ruby-ivar">@connection</span>.<span class="ruby-identifier">query</span>(<span class="ruby-identifier">params</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:q</span>), <span class="ruby-identifier">params</span>)&#x000A;      <span class="ruby-keyword kw">self</span>&#x000A;    <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000031'>
                <a name='M000031'>      </a>
                <div class='synopsis'>
                  <span class='name'>facet</span>
                  <span class='arguments'>(field_name)</span>
                </div>
                <div class='description'>
                  <p>
                  Get the facet object for the given field. This field will need to have been
                  requested as a field facet inside the search block.
                  </p>
                  <h4>Parameters</h4>
                  <table>
                  <tr><td valign="top">field_name<Symbol>:</td><td>field name for which to get the facet
                  
                  </td></tr>
                  </table>
                  <h4>Returns</h4>
                  <table>
                  <tr><td valign="top">Sunspot::Facet:</td><td><a href="Facet.html">Facet</a> object for the given field
                  
                  </td></tr>
                  </table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000031-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000031-source'><span class="ruby-comment cmt"># File lib/sunspot/search.rb, line 91</span>&#x000A;    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">facet</span>(<span class="ruby-identifier">field_name</span>)&#x000A;      (<span class="ruby-ivar">@facets_cache</span> <span class="ruby-operator">||=</span> {})[<span class="ruby-identifier">field_name</span>.<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">||=</span>&#x000A;        <span class="ruby-keyword kw">begin</span>&#x000A;          <span class="ruby-identifier">field</span> = <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">field</span>(<span class="ruby-identifier">field_name</span>)&#x000A;          <span class="ruby-constant">Facet</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@solr_result</span>.<span class="ruby-identifier">field_facets</span>(<span class="ruby-identifier">field</span>.<span class="ruby-identifier">indexed_name</span>), <span class="ruby-identifier">field</span>)&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000029'>
                <a name='M000029'>      </a>
                <div class='synopsis'>
                  <span class='name'>raw_results</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Access raw results without instantiating objects from persistent storage.
                  This may be useful if you are using search as an intermediate step in data
                  retrieval. Returns an ordered collection of objects that respond to
                  class_name and primary_key
                  </p>
                  <h4>Returns</h4>
                  <table>
                  <tr><td valign="top">Array:</td><td>Ordered collection of raw results
                  
                  </td></tr>
                  </table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000029-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000029-source'><span class="ruby-comment cmt"># File lib/sunspot/search.rb, line 64</span>&#x000A;    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raw_results</span>&#x000A;      <span class="ruby-ivar">@raw_results</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">hit_ids</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">hit_id</span><span class="ruby-operator">|</span> <span class="ruby-constant">RawResult</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">hit_id</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/([^ ]+) (.+)/</span>)[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>]) }&#x000A;    <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000028'>
                <a name='M000028'>      </a>
                <div class='synopsis'>
                  <span class='name'>results</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  Get the collection of results as instantiated objects. If WillPaginate is
                  available, the results will be a WillPaginate::Collection instance; if not,
                  it will be a vanilla Array.
                  </p>
                  <h4>Returns</h4>
                  <table>
                  <tr><td valign="top">WillPaginate::Collection or Array:</td><td>Instantiated result objects
                  
                  </td></tr>
                  </table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000028-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000028-source'><span class="ruby-comment cmt"># File lib/sunspot/search.rb, line 44</span>&#x000A;    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">results</span>&#x000A;      <span class="ruby-ivar">@results</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">page</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">WillPaginate</span><span class="ruby-operator">::</span><span class="ruby-constant">Collection</span>)&#x000A;        <span class="ruby-constant">WillPaginate</span><span class="ruby-operator">::</span><span class="ruby-constant">Collection</span>.<span class="ruby-identifier">create</span>(<span class="ruby-ivar">@query</span>.<span class="ruby-identifier">page</span>, <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">per_page</span>, <span class="ruby-ivar">@solr_result</span>.<span class="ruby-identifier">total_hits</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pager</span><span class="ruby-operator">|</span>&#x000A;          <span class="ruby-identifier">pager</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">result_objects</span>)&#x000A;        <span class="ruby-keyword kw">end</span>&#x000A;      <span class="ruby-keyword kw">else</span>&#x000A;        <span class="ruby-identifier">result_objects</span>&#x000A;      <span class="ruby-keyword kw">end</span>&#x000A;    <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000030'>
                <a name='M000030'>      </a>
                <div class='synopsis'>
                  <span class='name'>total</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='description'>
                  <p>
                  The total number of documents matching the query parameters
                  </p>
                  <h4>Returns</h4>
                  <table>
                  <tr><td valign="top">Integer:</td><td>Total matching documents
                  
                  </td></tr>
                  </table>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000030-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000030-source'><span class="ruby-comment cmt"># File lib/sunspot/search.rb, line 75</span>&#x000A;    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">total</span>&#x000A;      <span class="ruby-ivar">@total</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@solr_result</span>.<span class="ruby-identifier">total_hits</span>&#x000A;    <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
