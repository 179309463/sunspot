<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Sunspot::DSL::RestrictionWithNear [Sunspot 1.2.rc3 - Solr-powered search for Ruby objects - API Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Sunspot::DSL::RestrictionWithNear
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/lib/sunspot/dsl/restriction_with_near_rb.html">lib/sunspot/dsl/restriction_with_near.rb</a>
            (<a href="http://github.com/outoftime/sunspot/tree/v1.2.rc3/lib/sunspot/dsl/restriction_with_near.rb">view online</a>)
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a href="Restriction.html">Sunspot::DSL::Restriction</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000115">new</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000116">near</a></li>
            </ol>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000115'>
                <a name='M000115'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(field, scope, query, negated)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000115-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000115-source'><span class="ruby-comment cmt"># File lib/sunspot/dsl/restriction_with_near.rb, line 4</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">query</span>, <span class="ruby-identifier">negated</span>)&#x000A;        <span class="ruby-keyword kw">super</span>(<span class="ruby-identifier">field</span>, <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">negated</span>)&#x000A;        <span class="ruby-ivar">@query</span> = <span class="ruby-identifier">query</span>&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000116'>
                <a name='M000116'></a>
                <div class='synopsis'>
                  <span class='name'>near</span>
                  <span class='arguments'>(lat, lng, options = {})</span>
                </div>
                <div class='description'>
                  <p>
                  Perform a Geohash-based location restriction for the given `location`
                  field. Though this uses the same API as other attribute-field restrictions,
                  there are several differences between this and other scoping methods:
                  </p>
                  <ul>
                  <li>It can only be called from the top-level query; it cannot be nested in a
                  `dynamic`, `any_of`, or `all_of` block. This is because geohash queries are
                  not sent to Solr as filter queries like other scopes, but rather are part
                  of the fulltext query sent to Solr.
                  
                  </li>
                  <li>Because it is included with the fulltext query (if any), location
                  restrictions can be given boost. By default, an &#8220;exact&#8221;
                  (maximum-precision) match will give the result a boost of 1.0; each lower
                  level of precision gives a boost of 1/2 the next highest precision. See
                  below for options to modify this behavior.
                  
                  </li>
                  </ul>
                  <h4>What is a Geohash?</h4>
                  <p>
                  Geohash is a clever algorithm that creates a decodable digest of a
                  geographical point. It does this by dividing the globe into quadrants,
                  encoding the quadrant in which the point sits in the hash, dividing the
                  quadrant into smaller quadrants, and repeating an arbitrary number of times
                  (the &#8220;precision&#8221;). Because of the way Geohash are built, the
                  shared Geohash prefix length of two locations will <em>usually</em>
                  increase as the distance between the points decreases. Put another way, the
                  geohashes of two nearby points will <em>usually</em> have a longer shared
                  prefix than two points which are distant from one another.
                  </p>
                  <p>
                  Read more about Geohashes on <a
                  href="http://en.wikipedia.org/wiki/Geohash">Wikipedia</a> or play around
                  with generating your own at <a href="http://geohash.org/">geohash.org</a>.
                  </p>
                  <p>
                  In <a href="../../Sunspot.html">Sunspot</a>, GeoHashes can have a precision
                  between 3 and 12; this is the number of characters in the hash. The
                  precisions have the following maximum bounding box sizes, in miles:
                  </p>
                  <p>
                  <dt>3</dt> <dd>389.07812</dd> <dt>4</dt> <dd>97.26953</dd> <dt>5</dt>
                  <dd>24.31738</dd> <dt>6</dt> <dd>6.07935</dd> <dt>7</dt> <dd>1.51984
                  <dt>8</dt> <dd>0.37996</dd> <dt>9</dt> <dd>0.09499</dd> <dt>10</dt>
                  <dd>0.02375</dd> <dt>11</dt> <dd>0.00594</dd> <dt>12</dt> <dd>0.00148</dd>
                  </p>
                  <h4>Score, boost, and sorting with location search</h4>
                  <p>
                  The concept of relevance scoring is a familiar one from fulltext search;
                  Solr (or Lucene, actually) gives each result document a score based on how
                  relevant the document&#8217;s text is to the search phrase. Sunspot&#8217;s
                  location search also uses scoring to determine geographical relevance;
                  using boosts, longer prefix matches (which are, in general, geographically
                  closer to the search origin) are assigned higher relevance. This means that
                  the results of a pure location search are <em>roughly</em> in order of
                  geographical distance, as long as no other sort is specified explicitly.
                  </p>
                  <p>
                  This geographical relevance plays on the same field as fulltext scoring; if
                  you use both fulltext and geographical components in a single search, both
                  types of relevance will be taken into account when scoring the matches.
                  Thus, a very close fulltext match that&#8217;s further away from the
                  geographical origin will be scored similarly to a less precise fulltext
                  match that is very close to the geographical origin. That&#8217;s likely to
                  be consistent with the way most users would expect a fulltext geographical
                  search to work.
                  </p>
                  <h4>Options</h4>
                  <p>
                  <dt><tt>:precision</tt></dt> <dd>The minimum precision at which locations
                  should match. See the table of precisions and bounding-box sizes above; the
                  proximity value will ensure that all matching documents share a bounding
                  box of the corresponding maximum size with your origin point. The default
                  value is 7, meaning all results will share a bounding box with edges of
                  about one and a half miles with the origin.</dd> <dt><tt>:boost</tt></dt>
                  <dd>The boost to apply to maximum-precision matches. Default is 1.0. You
                  can use this option to adjust the weight given to geographic proximity
                  versus fulltext matching, if you are doing both in a search.</dd>
                  <dt><tt>:precision_factor</tt></dt> <dd>This option determines how much
                  boost is applied to matches at lower precisions. The default value, 16.0,
                  means that a match at precision N is 1/16 as relevant as a match at
                  precision N+1 (this is consistent with the fact that each precision&#8217;s
                  bounding box is about sixteen times the size of the next highest
                  precision.)</dd>
                  </p>
                  <h4>Example</h4>
                  <pre>Sunspot.search(Post) do&#x000A;  fulltext('pizza')&#x000A;  with(:location).near(-40.0, -70.0, :boost =&gt; 2, :precision =&gt; 6)&#x000A;end</pre>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000116-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000116-source'><span class="ruby-comment cmt"># File lib/sunspot/dsl/restriction_with_near.rb, line 116</span>&#x000A;      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">near</span>(<span class="ruby-identifier">lat</span>, <span class="ruby-identifier">lng</span>, <span class="ruby-identifier">options</span> = {})&#x000A;        <span class="ruby-ivar">@query</span>.<span class="ruby-identifier">fulltext</span>.<span class="ruby-identifier">add_location</span>(<span class="ruby-ivar">@field</span>, <span class="ruby-identifier">lat</span>, <span class="ruby-identifier">lng</span>, <span class="ruby-identifier">options</span>)&#x000A;      <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
