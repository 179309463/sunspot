<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sunspot::DSL::FieldQuery
  
    &mdash; Documentation by YARD 0.7.3
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (F)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../Sunspot.html" title="Sunspot (module)">Sunspot</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../DSL.html" title="Sunspot::DSL (module)">DSL</a></span></span>
     &raquo; 
    <span class="title">FieldQuery</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Sunspot::DSL::FieldQuery
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></li>
          
            <li class="next">Sunspot::DSL::FieldQuery</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">sunspot/lib/sunspot/dsl/field_query.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Provides an API for areas of the query DSL that operate on specific fields.
This functionality is provided by the query DSL and the dynamic query DSL.
</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="MoreLikeThisQuery.html" title="Sunspot::DSL::MoreLikeThisQuery (class)">MoreLikeThisQuery</a></span>, <span class='object_link'><a href="StandardQuery.html" title="Sunspot::DSL::StandardQuery (class)">StandardQuery</a></span></p>
</div>

  <h2>Constant Summary</h2>
  


  
  
  
  
  <h3 class="inherited">Constants inherited from <span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Scope.html#NONE-constant" title="Sunspot::DSL::Scope::NONE (constant)">NONE</a></span></p>



  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dynamic-instance_method" title="#dynamic (instance method)">- (Object) <strong>dynamic</strong>(base_name, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#facet-instance_method" title="#facet (instance method)">- (Object) <strong>facet</strong>(*field_names, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Request a facet on the search query.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (FieldQuery) <strong>initialize</strong>(search, query, setup) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
:nodoc:.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#order_by-instance_method" title="#order_by (instance method)">- (Object) <strong>order_by</strong>(field_name, direction = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Specify the order that results should be returned in.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#order_by_random-instance_method" title="#order_by_random (instance method)">- (Object) <strong>order_by_random</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
DEPRECATED Use <tt>order_by(:random)</tt>.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Scope.html" title="Sunspot::DSL::Scope (class)">Scope</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Scope.html#all_of-instance_method" title="Sunspot::DSL::Scope#all_of (method)">#all_of</a></span>, <span class='object_link'><a href="Scope.html#any_of-instance_method" title="Sunspot::DSL::Scope#any_of (method)">#any_of</a></span>, <span class='object_link'><a href="Scope.html#text_fields-instance_method" title="Sunspot::DSL::Scope#text_fields (method)">#text_fields</a></span>, <span class='object_link'><a href="Scope.html#with-instance_method" title="Sunspot::DSL::Scope#with (method)">#with</a></span>, <span class='object_link'><a href="Scope.html#without-instance_method" title="Sunspot::DSL::Scope#without (method)">#without</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sunspot::DSL::FieldQuery (class)">FieldQuery</a></span></tt>) <strong>initialize</strong>(search, query, setup) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
:nodoc:
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/field_query.rb', line 9</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id search'>search</span><span class='comma'>,</span> <span class='id query'>query</span><span class='comma'>,</span> <span class='id setup'>setup</span><span class='rparen'>)</span> <span class='comment'>#:nodoc:
</span>  <span class='ivar'>@search</span><span class='comma'>,</span> <span class='ivar'>@query</span> <span class='op'>=</span> <span class='id search'>search</span><span class='comma'>,</span> <span class='id query'>query</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id query'>query</span><span class='period'>.</span><span class='id scope'>scope</span><span class='comma'>,</span> <span class='id setup'>setup</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="dynamic-instance_method">
  
    - (<tt>Object</tt>) <strong>dynamic</strong>(base_name, &amp;block) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


270
271
272
273
274
275
276</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/field_query.rb', line 270</span>

<span class='kw'>def</span> <span class='id dynamic'>dynamic</span><span class='lparen'>(</span><span class='id base_name'>base_name</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id dynamic_field_factory'>dynamic_field_factory</span> <span class='op'>=</span> <span class='ivar'>@setup</span><span class='period'>.</span><span class='id dynamic_field_factory'>dynamic_field_factory</span><span class='lparen'>(</span><span class='id base_name'>base_name</span><span class='rparen'>)</span>
  <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Util</span><span class='period'>.</span><span class='id instance_eval_or_call'>instance_eval_or_call</span><span class='lparen'>(</span>
    <span class='const'>FieldQuery</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='ivar'>@search</span><span class='comma'>,</span> <span class='ivar'>@query</span><span class='comma'>,</span> <span class='id dynamic_field_factory'>dynamic_field_factory</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='op'>&amp;</span><span class='id block'>block</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="facet-instance_method">
  
    - (<tt>Object</tt>) <strong>facet</strong>(*field_names, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Request a facet on the search query. A facet is a feature of Solr that
determines the number of documents that match the existing search
<b>and</b> an additional criterion. This allows you to build powerful
drill-down interfaces for search, at each step presenting the searcher with
a set of refinements that are known to return results.
</p>
<p>
In Sunspot, each facet returns zero or more rows, each of which represents
a particular criterion conjoined with the actual query being performed. For
<em>field</em> <em>facets</em>, each row represents a particular value for
a given field. For <em>query</em> <em>facets</em>, each row represents an
arbitrary scope; the facet itself is just a means of logically grouping the
scopes.
</p>
<h3>Examples</h3>
<h4>Field Facets</h4>
<p>
A field facet is specified by passing one or more Symbol arguments to this
method:
</p>
<pre class="code">
  <span class='const'>Sunspot</span><span class='period'>.</span><span class='id search'>search</span><span class='lparen'>(</span><span class='const'>Post</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:blog_id</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id facet'>facet</span><span class='lparen'>(</span><span class='symbol'>:category_id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
</pre>
<p>
The facet specified above will have a row for each category_id that is
present in a document which also has a blog_id of 1.
</p>
<h4>Multiselect Facets</h4>
<p>
In certain circumstances, it is beneficial to exclude certain query scopes
from a facet; the most common example is multi-select faceting, where the
user has selected a certain value, but the facet should still show all
options that would be available if they had not:
</p>
<pre class="code">
  <span class='const'>Sunspot</span><span class='period'>.</span><span class='id search'>search</span><span class='lparen'>(</span><span class='const'>Post</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:blog_id</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id category_filter'>category_filter</span> <span class='op'>=</span> <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:category_id</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id facet'>facet</span><span class='lparen'>(</span><span class='symbol'>:category_id</span><span class='comma'>,</span> <span class='symbol'>:exclude</span> <span class='op'>=&gt;</span> <span class='id category_filter'>category_filter</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
<p>
Although the results of the above search will be restricted to those with a
category_id of 2, the category_id facet will operate as if a category had
not been selected, allowing the user to select additional categories (which
will presumably be ORed together).
</p>
<p>
It possible to exclude multiple filters by passing an array:
</p>
<pre class="code">
  <span class='const'>Sunspot</span><span class='period'>.</span><span class='id search'>search</span><span class='lparen'>(</span><span class='const'>Post</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:blog_id</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id category_filter'>category_filter</span> <span class='op'>=</span> <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:category_id</span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>
    <span class='id author_filter'>author_filter</span> <span class='op'>=</span> <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:author_id</span><span class='comma'>,</span> <span class='int'>3</span><span class='rparen'>)</span>
    <span class='id facet'>facet</span><span class='lparen'>(</span><span class='symbol'>:category_id</span><span class='comma'>,</span>
          <span class='symbol'>:exclude</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='id category_filter'>category_filter</span><span class='comma'>,</span> <span class='id author_filter'>author_filter</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id compact'>compact</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
<p>
You should consider using <tt>.compact</tt> to ensure that the array does
not  contain any nil values.
</p>
<p>
<strong>As far as I can tell, Solr only supports multi-select with field
facets; if <tt>:exclude</tt> is passed to a query facet, this method will
raise an error. Also, the <tt>:only</tt> and <tt>:extra</tt> options use
query faceting under the hood, so these can&#8217;t be used with
<tt>:extra</tt> either. </strong>
</p>
<h4>Query Facets</h4>
<p>
A query facet is a collection of arbitrary scopes, each of which represents
a row. This is specified by passing a block into the #facet method; the
block then contains one or more <tt>row</tt> blocks, each of which creates
a query facet row. The <tt>row</tt> blocks follow the usual Sunspot scope
DSL.
</p>
<p>
For example, a query facet can be used to facet over a set of ranges:
</p>
<pre class="code">
  <span class='const'>Sunspot</span><span class='period'>.</span><span class='id search'>search</span><span class='lparen'>(</span><span class='const'>Post</span><span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='id facet'>facet</span><span class='lparen'>(</span><span class='symbol'>:average_rating</span><span class='rparen'>)</span> <span class='kw'>do</span>
      <span class='id row'>row</span><span class='lparen'>(</span><span class='float'>1.0</span><span class='op'>..</span><span class='float'>2.0</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:average_rating</span><span class='comma'>,</span> <span class='float'>1.0</span><span class='op'>..</span><span class='float'>2.0</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id row'>row</span><span class='lparen'>(</span><span class='float'>2.0</span><span class='op'>..</span><span class='float'>3.0</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:average_rating</span><span class='comma'>,</span> <span class='float'>2.0</span><span class='op'>..</span><span class='float'>3.0</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id row'>row</span><span class='lparen'>(</span><span class='float'>3.0</span><span class='op'>..</span><span class='float'>4.0</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:average_rating</span><span class='comma'>,</span> <span class='float'>3.0</span><span class='op'>..</span><span class='float'>4.0</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='id row'>row</span><span class='lparen'>(</span><span class='float'>4.0</span><span class='op'>..</span><span class='float'>5.0</span><span class='rparen'>)</span> <span class='kw'>do</span>
        <span class='id with'>with</span><span class='lparen'>(</span><span class='symbol'>:average_rating</span><span class='comma'>,</span> <span class='float'>4.0</span><span class='op'>..</span><span class='float'>5.0</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
Note that the arguments to the <tt>facet</tt> and <tt>row</tt> methods
simply provide labels for the facet and its rows, so that they can be
retrieved and identified from the Search object. They are not passed to
Solr and no semantic meaning is attached to them. The label for
<tt>facet</tt> should be a symbol; the label for <tt>row</tt> can be
whatever you&#8217;d like.
</p>
<h4>Parameters</h4>
<table>
<tr><td valign="top">field_names&#8230;<Symbol></td><td><p>
fields for which to return field facets
</p>
</td></tr>
</table>
<h4>Options</h4>
<table>
<tr><td valign="top">:sort<Symbol></td><td><p>
Either :count (values matching the most terms first) or :index (lexical)
</p>
</td></tr>
<tr><td valign="top">:limit<Integer></td><td><p>
The maximum number of facet rows to return
</p>
</td></tr>
<tr><td valign="top">:minimum_count<Integer></td><td><p>
The minimum count a facet row must have to be returned
</p>
</td></tr>
<tr><td valign="top">:zeros<Boolean></td><td><p>
Return facet rows for which there are no matches (equivalent to
:minimum_count => 0). Default is false.
</p>
</td></tr>
<tr><td valign="top">:exclude<Object,Array></td><td><p>
Exclude one or more filters when performing the faceting (see Multiselect
Faceting above). The object given for this argument should be the return
value(s) of a scoping method (<tt>with</tt>, <tt>any_of</tt>,
<tt>all_of</tt>, etc.). <strong>Only can be used for field facets that do
not use the <tt>:extra</tt> or <tt>:only</tt> options.</strong>
</p>
</td></tr>
<tr><td valign="top">:name<Symbol></td><td><p>
Give a custom name to a field facet. The main use case for this option is
for requesting the same field facet multiple times, using different filter
exclusions (see Multiselect Faceting above). If you pass this option, it is
also the argument that should be passed to Search#facet when retrieving the
facet result.
</p>
</td></tr>
<tr><td valign="top">:only<Array></td><td><p>
Only return facet rows for the given values. Useful if you are only
interested in faceting on a subset of values for a given field.
<strong>Only applies to field facets.</strong>
</p>
</td></tr>
<tr><td valign="top">:extra<Symbol,Array></td><td><p>
One or more of :any and :none. :any returns a facet row with a count of all
matching documents that have some value for this field. :none returns a
facet row with a count of all matching documents that have no value for
this field. The facet row(s) corresponding to the extras have a value of
the symbol passed. <strong>Only applies to field facets.</strong>
</p>
</td></tr>
</table>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/field_query.rb', line 179</span>

<span class='kw'>def</span> <span class='id facet'>facet</span><span class='lparen'>(</span><span class='op'>*</span><span class='id field_names'>field_names</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id options'>options</span> <span class='op'>=</span> <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Util</span><span class='period'>.</span><span class='id extract_options_from'>extract_options_from</span><span class='lparen'>(</span><span class='id field_names'>field_names</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id block'>block</span>
    <span class='kw'>if</span> <span class='id field_names'>field_names</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>!=</span> <span class='int'>1</span>
      <span class='id raise'>raise</span><span class='lparen'>(</span>
        <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wrong number of arguments (</span><span class='embexpr_beg'>#{</span><span class='id field_names'>field_names</span><span class='period'>.</span><span class='id length'>length</span><span class='rbrace'>}</span><span class='tstring_content'> for 1)</span><span class='tstring_end'>&quot;</span></span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:exclude</span><span class='rparen'>)</span>
      <span class='id raise'>raise</span><span class='lparen'>(</span>
        <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can't use :exclude with query facets</span><span class='tstring_end'>&quot;</span></span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id search_facet'>search_facet</span> <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id add_query_facet'>add_query_facet</span><span class='lparen'>(</span><span class='id field_names'>field_names</span><span class='period'>.</span><span class='id first'>first</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
    <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Util</span><span class='period'>.</span><span class='id instance_eval_or_call'>instance_eval_or_call</span><span class='lparen'>(</span>
      <span class='const'>QueryFacet</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='ivar'>@query</span><span class='comma'>,</span> <span class='ivar'>@setup</span><span class='comma'>,</span> <span class='id search_facet'>search_facet</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='op'>&amp;</span><span class='id block'>block</span>
    <span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:only</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:exclude</span><span class='rparen'>)</span>
      <span class='id raise'>raise</span><span class='lparen'>(</span>
        <span class='const'>ArgumentError</span><span class='comma'>,</span>
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can't use :exclude with :only (see documentation)</span><span class='tstring_end'>&quot;</span></span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id field_names'>field_names</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id field_name'>field_name</span><span class='op'>|</span>
      <span class='id field'>field</span> <span class='op'>=</span> <span class='ivar'>@setup</span><span class='period'>.</span><span class='id field'>field</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='rparen'>)</span>
      <span class='id search_facet'>search_facet</span> <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id add_field_facet'>add_field_facet</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
      <span class='const'>Util</span><span class='period'>.</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:only</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id value'>value</span><span class='op'>|</span>
        <span class='id facet'>facet</span> <span class='op'>=</span> <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>QueryFacet</span><span class='period'>.</span><span class='id new'>new</span>
        <span class='id facet'>facet</span><span class='period'>.</span><span class='id add_positive_restriction'>add_positive_restriction</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Restriction</span><span class='op'>::</span><span class='const'>EqualTo</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
        <span class='ivar'>@query</span><span class='period'>.</span><span class='id add_query_facet'>add_query_facet</span><span class='lparen'>(</span><span class='id facet'>facet</span><span class='rparen'>)</span>
        <span class='id search_facet'>search_facet</span><span class='period'>.</span><span class='id add_row'>add_row</span><span class='lparen'>(</span><span class='id value'>value</span><span class='comma'>,</span> <span class='id facet'>facet</span><span class='period'>.</span><span class='id to_boolean_phrase'>to_boolean_phrase</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id field_names'>field_names</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id field_name'>field_name</span><span class='op'>|</span>
      <span class='id search_facet'>search_facet</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id field'>field</span> <span class='op'>=</span> <span class='ivar'>@setup</span><span class='period'>.</span><span class='id field'>field</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='rparen'>)</span>
      <span class='id facet'>facet</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:time_range</span><span class='rbracket'>]</span>
          <span class='kw'>unless</span> <span class='id field'>field</span><span class='period'>.</span><span class='id type'>type</span><span class='period'>.</span><span class='id is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>TimeType</span><span class='rparen'>)</span>
            <span class='id raise'>raise</span><span class='lparen'>(</span>
              <span class='const'>ArgumentError</span><span class='comma'>,</span>
              <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>:time_range can only be specified for Date or Time fields</span><span class='tstring_end'>'</span></span>
            <span class='rparen'>)</span>
          <span class='kw'>end</span>
          <span class='id search_facet'>search_facet</span> <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id add_date_facet'>add_date_facet</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
          <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>DateFieldFacet</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id search_facet'>search_facet</span> <span class='op'>=</span> <span class='ivar'>@search</span><span class='period'>.</span><span class='id add_field_facet'>add_field_facet</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
          <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>FieldFacet</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id field'>field</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='ivar'>@query</span><span class='period'>.</span><span class='id add_field_facet'>add_field_facet</span><span class='lparen'>(</span><span class='id facet'>facet</span><span class='rparen'>)</span>
      <span class='const'>Util</span><span class='period'>.</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:extra</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id extra'>extra</span><span class='op'>|</span>
        <span class='kw'>if</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:exclude</span><span class='rparen'>)</span>
          <span class='id raise'>raise</span><span class='lparen'>(</span>
            <span class='const'>ArgumentError</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>can't use :exclude with :extra (see documentation)</span><span class='tstring_end'>&quot;</span></span>
          <span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id extra_facet'>extra_facet</span> <span class='op'>=</span> <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>QueryFacet</span><span class='period'>.</span><span class='id new'>new</span>
        <span class='kw'>case</span> <span class='id extra'>extra</span>
        <span class='kw'>when</span> <span class='symbol'>:any</span>
          <span class='id extra_facet'>extra_facet</span><span class='period'>.</span><span class='id add_negated_restriction'>add_negated_restriction</span><span class='lparen'>(</span>
            <span class='id field'>field</span><span class='comma'>,</span>
            <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Restriction</span><span class='op'>::</span><span class='const'>EqualTo</span><span class='comma'>,</span>
            <span class='kw'>nil</span>
          <span class='rparen'>)</span>
        <span class='kw'>when</span> <span class='symbol'>:none</span>
          <span class='id extra_facet'>extra_facet</span><span class='period'>.</span><span class='id add_positive_restriction'>add_positive_restriction</span><span class='lparen'>(</span>
            <span class='id field'>field</span><span class='comma'>,</span>
            <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Restriction</span><span class='op'>::</span><span class='const'>EqualTo</span><span class='comma'>,</span>
            <span class='kw'>nil</span>
          <span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id raise'>raise</span><span class='lparen'>(</span>
            <span class='const'>ArgumentError</span><span class='comma'>,</span>
            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Allowed values for :extra are :any and :none</span><span class='tstring_end'>&quot;</span></span>
          <span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id search_facet'>search_facet</span><span class='period'>.</span><span class='id add_row'>add_row</span><span class='lparen'>(</span><span class='id extra'>extra</span><span class='comma'>,</span> <span class='id extra_facet'>extra_facet</span><span class='period'>.</span><span class='id to_boolean_phrase'>to_boolean_phrase</span><span class='rparen'>)</span>
        <span class='ivar'>@query</span><span class='period'>.</span><span class='id add_query_facet'>add_query_facet</span><span class='lparen'>(</span><span class='id extra_facet'>extra_facet</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="order_by-instance_method">
  
    - (<tt>Object</tt>) <strong>order_by</strong>(field_name, direction = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Specify the order that results should be returned in. This method can be
called multiple times; precedence will be in the order given.
</p>
<h4>Parameters</h4>
<table>
<tr><td valign="top">field_name<Symbol></td><td><p>
the field to use for ordering
</p>
</td></tr>
<tr><td valign="top">direction<Symbol></td><td><p>
:asc or :desc (default :asc)
</p>
</td></tr>
</table>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/field_query.rb', line 22</span>

<span class='kw'>def</span> <span class='id order_by'>order_by</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='comma'>,</span> <span class='id direction'>direction</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id sort'>sort</span> <span class='op'>=</span>
    <span class='kw'>if</span> <span class='id special'>special</span> <span class='op'>=</span> <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Sort</span><span class='period'>.</span><span class='id special'>special</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='rparen'>)</span>
      <span class='id special'>special</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id direction'>direction</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='const'>Sunspot</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Sort</span><span class='op'>::</span><span class='const'>FieldSort</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span>
        <span class='ivar'>@setup</span><span class='period'>.</span><span class='id field'>field</span><span class='lparen'>(</span><span class='id field_name'>field_name</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id direction'>direction</span>
      <span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='ivar'>@query</span><span class='period'>.</span><span class='id add_sort'>add_sort</span><span class='lparen'>(</span><span class='id sort'>sort</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="order_by_random-instance_method">
  
    - (<tt>Object</tt>) <strong>order_by_random</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
DEPRECATED Use <tt>order_by(:random)</tt>
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'sunspot/lib/sunspot/dsl/field_query.rb', line 37</span>

<span class='kw'>def</span> <span class='id order_by_random'>order_by_random</span>
  <span class='id order_by'>order_by</span><span class='lparen'>(</span><span class='symbol'>:random</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sat Nov 26 13:47:20 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.9.2).
</div>

  </body>
</html>